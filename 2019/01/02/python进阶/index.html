<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #222222; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #ff009e, 0 0 5px #ff009e; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #222222;    /*上边框颜色*/
        border-left-color: #222222;    /*左边框颜色*/
    }
</style>













<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.4.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"slideUpBigIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="魔法方法__init__ 和 __new__ __init__通常用于初始化一个新实例, 对这个实例添加一些属性, 做一些额外的工作, 属于对象方法 __new__通常用于控制生成一个新的实例, 属于类方法 __init__在实例生成后生效, __new__控制实例生成, 因此__init__在__new__后执行  __iter__和__next__通常要创建一个可迭代的对象(可迭代的类对象)，">
<meta name="keywords" content="Map&#x2F;Reduce">
<meta property="og:type" content="article">
<meta property="og:title" content="python进阶">
<meta property="og:url" content="http://yoursite.com/2019/01/02/python进阶/index.html">
<meta property="og:site_name" content="拆南墙">
<meta property="og:description" content="魔法方法__init__ 和 __new__ __init__通常用于初始化一个新实例, 对这个实例添加一些属性, 做一些额外的工作, 属于对象方法 __new__通常用于控制生成一个新的实例, 属于类方法 __init__在实例生成后生效, __new__控制实例生成, 因此__init__在__new__后执行  __iter__和__next__通常要创建一个可迭代的对象(可迭代的类对象)，">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-10-22T13:36:08.504Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="python进阶">
<meta name="twitter:description" content="魔法方法__init__ 和 __new__ __init__通常用于初始化一个新实例, 对这个实例添加一些属性, 做一些额外的工作, 属于对象方法 __new__通常用于控制生成一个新的实例, 属于类方法 __init__在实例生成后生效, __new__控制实例生成, 因此__init__在__new__后执行  __iter__和__next__通常要创建一个可迭代的对象(可迭代的类对象)，">






  <link rel="canonical" href="http://yoursite.com/2019/01/02/python进阶/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>python进阶 | 拆南墙</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	<!--githubstart-->
	
	<a href="https://your-url" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
	
	<!--githubend-->
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">拆南墙</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">nothing</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/02/python进阶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="rzlong">
      <meta itemprop="description" content="If should see you, after long year. How <br> should i greet, with silence and tears.">
      <meta itemprop="image" content="/uploads/you.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="拆南墙">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">python进阶
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-02 20:48:31" itemprop="dateCreated datePublished" datetime="2019-01-02T20:48:31+08:00">2019-01-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-22 21:36:08" itemprop="dateModified" datetime="2019-10-22T21:36:08+08:00">2019-10-22</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="魔法方法"><a href="#魔法方法" class="headerlink" title="魔法方法"></a>魔法方法</h2><h3 id="init-和-new"><a href="#init-和-new" class="headerlink" title="__init__ 和 __new__"></a>__init__ 和 __new__</h3><ul>
<li><code>__init__</code>通常用于初始化一个新实例, 对这个实例添加一些属性, 做一些额外的工作, 属于<code>对象方法</code></li>
<li><code>__new__</code>通常用于控制生成一个新的实例, 属于<code>类方法</code></li>
<li><code>__init__</code>在实例生成后生效, <code>__new__</code>控制实例生成, 因此<code>__init__</code>在<code>__new__</code>后执行</li>
</ul>
<h3 id="iter-和-next"><a href="#iter-和-next" class="headerlink" title="__iter__和__next__"></a>__iter__和__next__</h3><p>通常要创建一个可迭代的对象(可迭代的类对象)，需要定义<code>__iter__和__next__</code>对象，<strong>iter</strong>获取迭代器，<strong>next</strong>获取迭代器对象中值，若对象中的元素为空时，引出<code>StopIteration</code>错误</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        self.num = num</span><br><span class="line">        self.index = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> self.index &lt;= self.num:</span><br><span class="line">            <span class="keyword">if</span> is_prime(self.index):</span><br><span class="line">                <span class="keyword">return</span> self.index</span><br><span class="line">            self.index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">raise</span> StopIteration</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_prime</span><span class="params">(item)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> item <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, int(item ** <span class="number">0.5</span>) + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> item % i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">counter = Counter(<span class="number">50</span>)</span><br><span class="line">print(list(counter))</span><br><span class="line"><span class="comment"># [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47]</span></span><br></pre></td></tr></table></figure>
<h3 id="enter-和-exit"><a href="#enter-和-exit" class="headerlink" title="__enter__和__exit__"></a>__enter__和__exit__</h3><p>通常要创建一个上下文管理器对象，就需要定义<code>__iter__和__exit__</code>两个魔法方法，其中前者用于打开对象时执行的功能，后者用于关闭对象后执行的功能。</p>
<p>如果在执行 <a href="file:///C:/Users/Administrator/Desktop/python-3.6.9-docs-html/python-3.6.9-docs-html/reference/compound_stmts.html#with" target="_blank" rel="noopener"><code>with</code></a> 语句的语句体期间发生了异常，则参数会包含异常的类型、值以及回溯信息。 在其他情况下三个参数均为 <code>None</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeThis</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, label)</span>:</span></span><br><span class="line">        self.label = label</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.start = time.time()</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_value, traceback)</span>:</span></span><br><span class="line">        end = time.time()</span><br><span class="line">        print(<span class="string">f'<span class="subst">&#123;self.label&#125;</span>waste time <span class="subst">&#123;str(end-self.start)&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.label</span><br><span class="line">    </span><br><span class="line"><span class="keyword">with</span> TimeThis(<span class="string">'波斯猫'</span>) <span class="keyword">as</span> tt:</span><br><span class="line">    print(<span class="string">'func()'</span>)</span><br><span class="line">  </span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">func()</span></span><br><span class="line"><span class="string">波斯猫waste time 1.0010571479797363</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h3 id="hash-和-eq"><a href="#hash-和-eq" class="headerlink" title="__hash__和__eq__"></a>__hash__和__eq__</h3><p>对于两个类，是不能直接使用比较运算的；而为了达到这个目的，根据<code>__hash__和__eq__</code>两个魔法方法可以实现类对象之间的比较</p>
<p>集合类型和字典类型其底层实现原理就是根据<code>__hash__和__eq__</code>去判断元素是否相同或不同的元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> hash((self.name, self.age)) == hash(other.name, other.age)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name == other.name <span class="keyword">and</span> self.age == other.age</span><br><span class="line">    </span><br><span class="line">p1 = Person(<span class="string">'王安石'</span>, <span class="number">40</span>)</span><br><span class="line">p2 = Person(<span class="string">'王安石'</span>, <span class="number">40</span>)</span><br><span class="line">p3 = Person(<span class="string">'王维'</span>， <span class="number">50</span>)</span><br><span class="line">p1 == p2, p1 == p1, p1 == p3</span><br><span class="line"></span><br><span class="line"><span class="comment"># (True, True, False)</span></span><br></pre></td></tr></table></figure>
<h3 id="call"><a href="#call" class="headerlink" title="__call__"></a>__call__</h3><p>在Python中，函数是一等的对象，可以传递到函数和方法中。如果要使一个类的对象也表现跟函数一样的特点，可以使用<code>__call__</code>方法去实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span>:</span></span><br><span class="line">    <span class="string">'''表示一个实体的类，调用它的实例可以更新实体的位置'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,size,x,y)</span>:</span></span><br><span class="line">        self.x, self.y = x, y</span><br><span class="line">        self.size = size</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self,x,y)</span>:</span></span><br><span class="line">        <span class="string">'''改变实体的位置'''</span></span><br><span class="line">        self.x, self.y = x, y</span><br><span class="line">entity = Entity(<span class="number">20</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">print(entity.x, entity.y)</span><br><span class="line">entity(<span class="number">2</span>, <span class="number">10</span>)</span><br><span class="line">print(entity.x, entity.y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4 5</span></span><br><span class="line"><span class="comment"># 2 10</span></span><br></pre></td></tr></table></figure>
<h3 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h3><p><code>__eq__ __ne__ __lt __gt__ __le__ __ge__</code></p>
<a id="more"></a>
<h2 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h2><p><code>单例指的是对一个单一的类, 它负责创建自己的对象, 同时确保单个对象只有一个实例。</code></p>
<p>注意:</p>
<ol>
<li>单例类只能有一个实例</li>
<li>单例类必须自己创建自己的唯一实例</li>
<li>单例类必须给所有其他对象提供这个实例</li>
</ol>
<p>单例的实现方式很多，但是使用类的装饰器和元类构建装饰器是最容易被使用的方式</p>
<h3 id="装饰器实现"><a href="#装饰器实现" class="headerlink" title="装饰器实现"></a>装饰器实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">singleton</span><span class="params">(cls)</span>:</span></span><br><span class="line">    instances = &#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @wraps(cls)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> instances:</span><br><span class="line">            instances[cls] = cls(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> instances[cls]</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestSingleton</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"> </span><br><span class="line">a = TestSingleton(<span class="string">'实例a'</span>)</span><br><span class="line">b = TestSingleton(<span class="string">'实例b'</span>)</span><br><span class="line">c = TestSingleton.__wrapped__(<span class="string">'实例c'</span>)</span><br><span class="line">d = TestSingleton.__wrapped__(<span class="string">'实例d'</span>)</span><br><span class="line">print(a,b,c,d) <span class="comment"># 实例a 实例a 实例c 实例d</span></span><br></pre></td></tr></table></figure>
<p>以上的内容只能保证在单线程下的正确性，但是在多线程环境下，线程之间可能重复执行导致丢失更新，需要给数据加锁</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> RLock</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">singleton</span><span class="params">(cls)</span>:</span></span><br><span class="line">    instances = &#123;&#125;</span><br><span class="line">    lock = RLock() <span class="comment">#重入锁，可再次取到锁对象(普通锁是Lock)</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @wraps(cls)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    	<span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> instances: <span class="comment"># 先判断有没有实例，若有直接返回</span></span><br><span class="line">            <span class="keyword">with</span> lock: <span class="comment"># 加锁，保证多线程环境</span></span><br><span class="line">                <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> instances: <span class="comment"># 加锁判断实例</span></span><br><span class="line">                    instances[cls] = cls(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> instances[cls]</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>
<h3 id="元类"><a href="#元类" class="headerlink" title="元类"></a>元类</h3><p>对象是类的实例，而类就是元类的实例</p>
<p>自定义元类继承于type，要重写<code>__new__/__init__,__call__</code>等魔术方法</p>
<p>其中 <code>__call__</code>相当于元类造出类的构造器</p>
<p>Python 3中使用元类可以在定义类时通过(<code>metaclass=元类</code>)来使用</p>
<p>Python 2中可以在类中添加<code>__metaclass__</code>魔法属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonMeta</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="string">"""自定义元类,继承于type"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls, <span class="string">'instance'</span>):</span><br><span class="line">            cls.instance = super().__call__(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(metaclass=SingletonMeta)</span>:</span></span><br><span class="line">    <span class="comment"># __metaclass__=SingletonMeta #python2的做法现在也支持</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    p1 = Person(<span class="string">'dawda'</span>)</span><br><span class="line">    p2 = Person(<span class="string">'apple'</span>)</span><br><span class="line">    print(p1.name)</span><br><span class="line">    print(p2)</span><br></pre></td></tr></table></figure>
<p>也可以直接写在<code>__new__</code>魔术方法中实现单例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls, <span class="string">'instance'</span>):</span><br><span class="line">            cls.instance = super(Singleton, cls).__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br></pre></td></tr></table></figure>
<h2 id="迭代器和生产器"><a href="#迭代器和生产器" class="headerlink" title="迭代器和生产器"></a>迭代器和生产器</h2><h3 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h3><p>拥有<code>__iter__</code>和<code>__next__</code>两个魔方方法的对象(字符串、列表、元祖或类)，它就是一个迭代器</p>
<p><strong>iter</strong>方法可以将一个对象变成迭代器对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用hashlib模块检查文件的哈希摘要</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">hasher = hashlib.md5()</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">r'xadmin.zip'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">	<span class="keyword">for</span> data <span class="keyword">in</span> iter(<span class="keyword">lambda</span>: f.read(<span class="number">1024</span>), <span class="string">b''</span>):</span><br><span class="line">		hasher.update(data)</span><br><span class="line">print(hasher.hexdigest())</span><br></pre></td></tr></table></figure>
<h3 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h3><p>在Python中，使用关键字的<strong>yield</strong>的函数就是一个生成器<code>generator</code></p>
<p>生成器返回的就是一个迭代器对象，只能用于迭代操作；每次遇到yield函数（让步操作，让出CPU）时会暂停保存当前的所有运行信息和状态，并在下一次执行next方法会从上一次运行的位置继续执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(num)</span>:</span></span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line">    b = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(num):</span><br><span class="line">        a, b = b, a + b</span><br><span class="line">    	<span class="keyword">yield</span> a</span><br><span class="line"></span><br><span class="line">b = foo(<span class="number">5</span>)</span><br><span class="line">print(list(b))</span><br></pre></td></tr></table></figure>
<h3 id="生成式"><a href="#生成式" class="headerlink" title="生成式"></a>生成式</h3><p><strong>案例: 将字典实现反转</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">i_dict = &#123;<span class="number">1</span>: <span class="string">'a'</span>, <span class="number">2</span>: <span class="string">'b'</span>, <span class="number">3</span>: <span class="string">'c'</span>&#125;</span><br><span class="line"><span class="comment"># 用dict(列表生成式), 列表中是二位元素组成的元组</span></span><br><span class="line">im_dict = dict([(v, k) <span class="keyword">for</span> k, v <span class="keyword">in</span> i_dict.items()]) <span class="comment"># &#123;'a': 1, 'b': 2, 'c': 3&#125;</span></span><br><span class="line"><span class="comment"># 使用字典生成式</span></span><br><span class="line">im2_dict = &#123;v:k <span class="keyword">for</span> k, v <span class="keyword">in</span> i_dict.items()&#125; <span class="comment"># &#123;'a': 1, 'b': 2, 'c': 3&#125;</span></span><br><span class="line"><span class="comment"># 使用dict(zip)</span></span><br><span class="line">im3_dict = dict(zip(i_dict.values(), i_dict.keys())) <span class="comment"># &#123;'a': 1, 'b': 2, 'c': 3&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>案例: 一行代码实现阶乘</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> mul</span><br><span class="line"><span class="comment"># 方法1 使用int.__mul__ 实现乘法</span></span><br><span class="line">fact = reduce(int.__mul__, range(<span class="number">1</span>, <span class="number">10</span>)) <span class="comment"># 实现9的阶乘</span></span><br><span class="line"><span class="comment"># 方法2 使用operator.mul 实现乘法</span></span><br><span class="line">fact = reduce(mul, range(<span class="number">1</span>, <span class="number">10</span>)) <span class="comment"># 实现9的阶乘</span></span><br><span class="line"><span class="comment"># 方法3 使用lambda函数, 不推荐使用</span></span><br><span class="line">fact = reduce(<span class="keyword">lambda</span> x, y: x * y, range(<span class="number">1</span>, <span class="number">10</span>)) <span class="comment"># 实现9的阶乘</span></span><br></pre></td></tr></table></figure>
<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><p>旧写法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XxxMiddleware</span><span class="params">()</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_view</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_template_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>新写法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xxx_middleware</span><span class="params">(get_response)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">middleware</span><span class="params">(request, *args, **kwargs)</span>:</span></span><br><span class="line">        </span><br><span class="line">        resp = get_response(request, *args, **kwargs)</span><br><span class="line">		</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>
<h2 id="上下文语法"><a href="#上下文语法" class="headerlink" title="上下文语法"></a>上下文语法</h2><p>上下文语法都需要提供<code>__enter__</code>和<code>__exit__</code>两个魔术方法</p>
<h3 id="contextmanger上下文管理器"><a href="#contextmanger上下文管理器" class="headerlink" title="contextmanger上下文管理器"></a>contextmanger上下文管理器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># contextmanager 提供了__enter__方法</span></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">record_time</span><span class="params">()</span>:</span></span><br><span class="line">    start = time()</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'yield 返回值'</span></span><br><span class="line">    end = time()</span><br><span class="line">    print(<span class="string">f'执行时间<span class="subst">&#123;end - start&#125;</span>'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> num <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> num * foo(num - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> record_time() <span class="keyword">as</span> msg:</span><br><span class="line">    print(msg)</span><br><span class="line">    print(foo(<span class="number">100</span>))</span><br></pre></td></tr></table></figure>
<h3 id="atomic事务上下文管理器"><a href="#atomic事务上下文管理器" class="headerlink" title="atomic事务上下文管理器"></a>atomic事务上下文管理器</h3><p>Django提供的一种直接给函数 事务环境的方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.transaction <span class="keyword">import</span> atomic</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用with</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> atomic():</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用装饰器</span></span><br><span class="line"><span class="meta">@atomic()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo2_view</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h2 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h2><p>装饰器属于代理模式，实际上是给某个程序增加功能。而装饰器需要满足</p>
<ul>
<li>不能修改被装饰函数的源代码</li>
<li>不能修改被装饰函数的调用方式</li>
<li>满足上述2个条件，给函数增加功能</li>
</ul>
<h3 id="不带参装饰器"><a href="#不带参装饰器" class="headerlink" title="不带参装饰器"></a>不带参装饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(func)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># 装饰代码</span></span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 装饰代码</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(result, str):</span><br><span class="line">            result = result[::<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line">    </span><br><span class="line"><span class="meta">@decorate</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'hello wraps'</span></span><br><span class="line">	</span><br><span class="line">print(foo(), foo.__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># wraps的作用</span></span><br><span class="line"><span class="comment"># 1. 没有wraps时执行 foo.__name__ 会返回装饰器内返回的函数名(wrapper)</span></span><br><span class="line"><span class="comment"># 2. __wrapped__ 魔法方法会执行被装饰的函数(无装饰器作用)</span></span><br><span class="line">print(foo.__wrapped__())</span><br></pre></td></tr></table></figure>
<h3 id="带参装饰器"><a href="#带参装饰器" class="headerlink" title="带参装饰器"></a>带参装饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time, sleep</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">record_time</span><span class="params">(output)</span>:</span></span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">        @wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        	start = time()</span><br><span class="line">        	result = func(*args, **kwargs)</span><br><span class="line">            end = time()</span><br><span class="line">            output(func.__name__, end - start)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> decorate</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> decorate</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">output_file</span><span class="params">(name, duration)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">r'abc.txt'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">f'<span class="subst">&#123;name&#125;</span>执行时间是<span class="subst">&#123;duration&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@record_time(output_file)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'hello foo'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    a = foo()</span><br><span class="line">    print(a)</span><br></pre></td></tr></table></figure>
<h2 id="python高阶函数"><a href="#python高阶函数" class="headerlink" title="python高阶函数"></a>python高阶函数</h2><h3 id="filter过滤"><a href="#filter过滤" class="headerlink" title="filter过滤"></a>filter过滤</h3><p>使用方法: <strong>filter(function, iterable)</strong><br>对可迭代对象, 根据function函数进行过滤(对序列中的每个元素过滤)<br>同时, python2.x中filter返回的是一个列表, python3返回的是一个迭代器对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_odd</span><span class="params">(n)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> n % <span class="number">2</span></span><br><span class="line">newlist = filter(is_odd, range(<span class="number">1</span>,<span class="number">10</span>))</span><br><span class="line">t_list = [i <span class="keyword">for</span> i <span class="keyword">in</span> newlist]</span><br><span class="line">print(t_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出: [1,3,5,7,9]</span></span><br></pre></td></tr></table></figure>
<h3 id="map映射"><a href="#map映射" class="headerlink" title="map映射"></a>map映射</h3><p>使用方法: <strong>map(function, iterable)</strong></p>
<p>对可迭代对象, 根据function函数进行转换(<code>function函数作用于序列中的每一个元素</code>), 返回一个迭代器对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x*x</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = map(f,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(r)</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure>
<h3 id="sorted排序"><a href="#sorted排序" class="headerlink" title="sorted排序"></a>sorted排序</h3><p>内置排序函数, 对所有可迭代对象生效<br>使用方法: <strong>sorted(iterable[, cmp[, key[], reverse]])</strong></p>
<ul>
<li>cmp 比较的函数, 它具有两个参数, 参数的值从可迭代的对象取出(遵守的规则为大于返回1, 小于返回-1，等于返回0) –&gt; <code>python3.x中已取消这个参数</code></li>
<li>key 比较的函数, 具有一个参数, 参数的值从可迭代的对象中取出</li>
<li>reverse  排序规则， 默认为升序False, 为True降序</li>
</ul>
<h2 id="functools模块"><a href="#functools模块" class="headerlink" title="functools模块"></a>functools模块</h2><h3 id="reduce化简"><a href="#reduce化简" class="headerlink" title="reduce化简"></a>reduce化简</h3><p>使用方法：<strong>reduce(function, iterable[, initializer])</strong></p>
<p>对可迭代对象使用, 根据function函数进行转换(<code>function函数必须有两个参数, 并且对序列中两两之间作累积运算</code>), 返回一个元素(值);最后一个参数是初始值参数, 可选。</p>
<p>例如: reduce(f, [a, b, c, d]) = f(f(f(a,b),c),d)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(x, y)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x*<span class="number">10</span> + y</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r2 = reduce(f2, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r2</span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure>
<p>实现将str转换成int</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(x, y)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x*<span class="number">10</span> + y</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">char2int</span><span class="params">(key)</span>:</span></span><br><span class="line"><span class="meta">... </span>    num_dict = &#123;<span class="string">'0'</span>: <span class="number">0</span>, <span class="string">'1'</span>: <span class="number">1</span>, <span class="string">'2'</span>: <span class="number">2</span>, <span class="string">'3'</span>: <span class="number">3</span>, <span class="string">'4'</span>: <span class="number">4</span>, <span class="string">'5'</span>: <span class="number">5</span>, <span class="string">'6'</span>: <span class="number">6</span>, <span class="string">'7'</span>: <span class="number">7</span>, <span class="string">'8'</span>: <span class="number">8</span>, <span class="string">'9'</span>: <span class="number">9</span>&#125;</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> num_dict[key]</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>result = reduce(f1, map(char2int, <span class="string">'12345'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>result</span><br><span class="line"><span class="number">12345</span></span><br></pre></td></tr></table></figure>
<h3 id="wraps"><a href="#wraps" class="headerlink" title="wraps"></a>wraps</h3><p>wraps可以方便的使用函数装饰器的功能，它能够自动的设定选择是否选用装饰器<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">my_decorator</span><span class="params">(f)</span>:</span></span><br><span class="line"><span class="meta">... </span>    @wraps(f)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwds)</span>:</span></span><br><span class="line"><span class="meta">... </span>        print(<span class="string">'Calling decorated function'</span>)</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> f(*args, **kwds)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> wrapper</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@my_decorator</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">example</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">"""Docstring"""</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Called example function'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>example()</span><br><span class="line">Calling decorated function</span><br><span class="line">Called example function</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>example.__wrapped__()</span><br><span class="line">Called example function</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>example.__name__</span><br><span class="line"><span class="string">'example'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>example.__doc__</span><br><span class="line"><span class="string">'Docstring'</span></span><br></pre></td></tr></table></figure></p>
<ol>
<li>没有wraps时执行 <code>foo.__name__</code>会返回装饰器内函数的名字(wrapper)，有wraps时，其返回被装饰函数的名字(exmaple)</li>
<li><code>__wrapped__</code> 魔法方法会执行被装饰的函数(无装饰器作用)</li>
</ol>
<h3 id="partial"><a href="#partial" class="headerlink" title="partial"></a>partial</h3><p>偏函数，先看核心源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial</span><span class="params">(func, *args, **keywords)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">newfunc</span><span class="params">(*fargs, **fkeywords)</span>:</span></span><br><span class="line">        newkeywords = keywords.copy()</span><br><span class="line">        newkeywords.update(fkeywords)</span><br><span class="line">        <span class="keyword">return</span> func(*args, *fargs, **newkeywords)</span><br><span class="line">    newfunc.func = func</span><br><span class="line">    newfunc.args = args</span><br><span class="line">    newfunc.keywords = keywords</span><br><span class="line">    <span class="keyword">return</span> newfunc</span><br></pre></td></tr></table></figure>
<p>其结构类似于装饰器，但是其改变被装饰函数的结构，因此又不能成为装饰器。</p>
<p>看上面代码，partial函数将自己的关键字参数<code>**kwargs</code>更新到被装饰函数中，将自己的位置参数<code>*args</code>放到被装饰函数的位置参数前，然后再执行被装饰函数，再举个例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adds</span><span class="params">(x, *args)</span>:</span></span><br><span class="line">	print(x, *args)</span><br><span class="line">	<span class="keyword">return</span> x + sum(args)</span><br><span class="line">	</span><br><span class="line">p = partial(adds, <span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">p(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#output（partial的位置参数放在被装饰函数的位置参数前，再执行使用被装饰函数）</span></span><br><span class="line"><span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="number">21</span></span><br></pre></td></tr></table></figure>
<h3 id="lru-cache"><a href="#lru-cache" class="headerlink" title="lru_cache"></a>lru_cache</h3><p>最近最久未使用</p>
<h2 id="itertools模块"><a href="#itertools模块" class="headerlink" title="itertools模块"></a>itertools模块</h2><h3 id="groupby数据分组"><a href="#groupby数据分组" class="headerlink" title="groupby数据分组"></a>groupby数据分组</h3><p>用法: <strong>groupby(iterable, key=function)</strong></p>
<p><code>groupby()</code>函数扫描整个序列并且查找连续相同值，并根据key函数返回值相同的元素序列。在每次迭代的时候，它会<strong>返回一个值和一个迭代器对象</strong>，这个迭代器对象可以生成元素值全部等于上面那个值的组中所有对象。</p>
<p>必须注意的是，这个待操作<strong>数据是预先已排好序的</strong>。因为groupby仅仅检查连续的元素，它不会做排序操作。如果没有预先排序，得到的结果就不是预期的结果。</p>
<p>一个比较好的操作就是将数据分组和defaultdict(构建多值字典)结合使用 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> groupby</span><br><span class="line">test5 = [</span><br><span class="line">	&#123;<span class="string">'classroom'</span>: <span class="string">'1401'</span>, <span class="string">'name'</span>: <span class="string">'joy'</span>, <span class="string">'age'</span>: <span class="number">11</span>&#125;,</span><br><span class="line">	&#123;<span class="string">'classroom'</span>: <span class="string">'1402'</span>, <span class="string">'name'</span>: <span class="string">'chrome'</span>, <span class="string">'age'</span>: <span class="number">12</span>&#125;,</span><br><span class="line">	&#123;<span class="string">'classroom'</span>: <span class="string">'1403'</span>, <span class="string">'name'</span>: <span class="string">'scape'</span>, <span class="string">'age'</span>: <span class="number">20</span>&#125;,</span><br><span class="line">	&#123;<span class="string">'classroom'</span>: <span class="string">'1403'</span>, <span class="string">'name'</span>: <span class="string">'safril'</span>, <span class="string">'age'</span>: <span class="number">15</span>&#125;,</span><br><span class="line">	&#123;<span class="string">'classroom'</span>: <span class="string">'1401'</span>, <span class="string">'name'</span>: <span class="string">'ie'</span>, <span class="string">'age'</span>: <span class="number">12</span>&#125;,</span><br><span class="line">	&#123;<span class="string">'classroom'</span>: <span class="string">'1403'</span>, <span class="string">'name'</span>: <span class="string">'abc'</span>, <span class="string">'age'</span>: <span class="number">14</span>&#125;</span><br><span class="line">]</span><br><span class="line">test5_sort = sorted(test5, key=itemgetter(<span class="string">'classroom'</span>, <span class="string">'age'</span>))</span><br><span class="line">e = defaultdict(list)</span><br><span class="line"><span class="keyword">for</span> classroom, items <span class="keyword">in</span> groupby(test5_sort, key=itemgetter(<span class="string">'classroom'</span>)):</span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">		e[classroom].append(item)</span><br><span class="line">print(e)</span><br><span class="line"><span class="comment"># defaultdict(&lt;class 'list'&gt;, &#123;'1401': [&#123;'classroom': '1401', 'name': 'joy', 'age': 11&#125;, &#123;'classroom': '1401', 'name': 'ie', 'age': 12&#125;], '1402': [&#123;'classroom': '1402', 'name': 'chrome', 'age': 12&#125;], '1403': [&#123;'classroom': '1403', 'name': 'abc', 'age': 14&#125;, &#123;'classroom': '1403', 'name': 'safril', 'age': 15&#125;, &#123;'classroom': '1403', 'name': 'scape', 'age': 20&#125;]&#125;)</span></span><br></pre></td></tr></table></figure>
<h3 id="compress过滤"><a href="#compress过滤" class="headerlink" title="compress过滤"></a>compress过滤</h3><p>它是将一个可迭代对象序列根据另一个由布尔类型元素组成的序列进行过滤，返回一个迭代器。</p>
<p>使用方法: <strong>compress(iterable, bool_seq)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test6 = [<span class="string">'first'</span>, <span class="string">'second'</span>, <span class="string">'third'</span>, <span class="string">'fourth'</span>, <span class="string">'fifth'</span>, <span class="string">'sixth'</span>]</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> compress</span><br><span class="line">test6_cp = compress(test6, [<span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">True</span>])</span><br><span class="line">print(list(test6_cp)) <span class="comment"># ['first', 'fifth', 'sixth']</span></span><br></pre></td></tr></table></figure>
<h3 id="permutations排列"><a href="#permutations排列" class="headerlink" title="permutations排列"></a>permutations排列</h3><h3 id="combinations组合"><a href="#combinations组合" class="headerlink" title="combinations组合"></a>combinations组合</h3><h3 id="product笛卡尔积"><a href="#product笛卡尔积" class="headerlink" title="product笛卡尔积"></a>product笛卡尔积</h3><h2 id="collections模块"><a href="#collections模块" class="headerlink" title="collections模块"></a>collections模块</h2><h3 id="deque双端队列"><a href="#deque双端队列" class="headerlink" title="deque双端队列"></a>deque双端队列</h3><p>deque, 即<code>双端队列(double-ended queue)</code>, 它增加了从头部操作的popleft()和appendleft()，并且它同时也支持列表的一些方法(如append(),pop(),insert()等)</p>
<p>deque给定一个<code>maxlen</code>参数，指定队列的最大长度。如果队列中的元素超过最大长度，就会去除旧元素。</p>
<p>与列表相比, 队列在两端插入或删除的时间复杂度都是O(1)，而在列表的开头插入或删除的时间复杂度是O(N)，在列表的结束插入append或删除pop的时间复杂度是O(1)，pop(index)是O(N)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line">b = deque([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], maxlen=<span class="number">5</span>)</span><br><span class="line">b.append(<span class="number">6</span>)</span><br><span class="line">print(b) <span class="comment"># deque([2, 3, 4, 5, 6], maxlen=5)</span></span><br><span class="line">b.popleft()</span><br><span class="line">print(b) <span class="comment"># deque([3, 4, 5, 6], maxlen=5)</span></span><br><span class="line">b.appendleft(<span class="number">10</span>)</span><br><span class="line">print(b) <span class="comment"># deque([10, 3, 4, 5, 6], maxlen=5)</span></span><br><span class="line">b.pop()</span><br><span class="line">print(b) <span class="comment"># deque([10, 3, 4, 5], maxlen=5)</span></span><br></pre></td></tr></table></figure>
<h3 id="Counter计数器"><a href="#Counter计数器" class="headerlink" title="Counter计数器"></a>Counter计数器</h3><p>Counter, 作为计数器使用, 作用对象是可序列化的对象，它的底层是通过字典来实现的，因为也可以通过字典的方法增加计数器的值。</p>
<p>Counter对象之间能够使用数学运算</p>
<p><code>most_common(N)</code>能返回前N个元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">62</span>]: <span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">In [<span class="number">63</span>]: test1 = [<span class="string">'a'</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">'a'</span>, <span class="number">10</span>, <span class="string">'b'</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">64</span>]: test2 = (<span class="string">'x'</span>, <span class="number">4</span>, <span class="string">'info'</span>, <span class="number">4</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">65</span>]: counter1 = Counter(test1)</span><br><span class="line"></span><br><span class="line">In [<span class="number">66</span>]: counter2 = Counter(test2)</span><br><span class="line"></span><br><span class="line">In [<span class="number">67</span>]: counter1</span><br><span class="line">Out[<span class="number">67</span>]: Counter(&#123;<span class="string">'a'</span>: <span class="number">2</span>, <span class="number">1</span>: <span class="number">1</span>, <span class="number">2</span>: <span class="number">2</span>, <span class="number">10</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">68</span>]: counter2</span><br><span class="line">Out[<span class="number">68</span>]: Counter(&#123;<span class="string">'x'</span>: <span class="number">1</span>, <span class="number">4</span>: <span class="number">2</span>, <span class="string">'info'</span>: <span class="number">1</span>, <span class="number">10</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="comment"># 对相同键的元素进行加法操作</span></span><br><span class="line">In [<span class="number">69</span>]: counter1 + counter2</span><br><span class="line">Out[<span class="number">69</span>]: Counter(&#123;<span class="string">'a'</span>: <span class="number">2</span>, <span class="number">1</span>: <span class="number">1</span>, <span class="number">2</span>: <span class="number">2</span>, <span class="number">10</span>: <span class="number">2</span>, <span class="string">'b'</span>: <span class="number">1</span>, <span class="string">'x'</span>: <span class="number">1</span>, <span class="number">4</span>: <span class="number">2</span>, <span class="string">'info'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="comment"># 减操作，不够减的情况删除键</span></span><br><span class="line">In [<span class="number">70</span>]: counter1 - counter2</span><br><span class="line">Out[<span class="number">70</span>]: Counter(&#123;<span class="string">'a'</span>: <span class="number">2</span>, <span class="number">1</span>: <span class="number">1</span>, <span class="number">2</span>: <span class="number">2</span>, <span class="string">'b'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="comment"># 返回前两个统计数据</span></span><br><span class="line">In [<span class="number">71</span>]: counter1.most_common(<span class="number">2</span>)</span><br><span class="line">Out[<span class="number">71</span>]: [(<span class="string">'a'</span>, <span class="number">2</span>), (<span class="number">2</span>, <span class="number">2</span>)]</span><br><span class="line"><span class="comment"># 返回所有的统计数据</span></span><br><span class="line">In [<span class="number">72</span>]: counter1.most_common()</span><br><span class="line">Out[<span class="number">72</span>]: [(<span class="string">'a'</span>, <span class="number">2</span>), (<span class="number">2</span>, <span class="number">2</span>), (<span class="number">1</span>, <span class="number">1</span>), (<span class="number">10</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">1</span>)]</span><br><span class="line"><span class="comment"># 在返回所有的情况进行切片操作</span></span><br><span class="line">In [<span class="number">73</span>]: counter1.most_common()[:<span class="number">2</span>]</span><br><span class="line">Out[<span class="number">73</span>]: [(<span class="string">'a'</span>, <span class="number">2</span>), (<span class="number">2</span>, <span class="number">2</span>)]</span><br></pre></td></tr></table></figure>
<h3 id="OrderedDict有序字典"><a href="#OrderedDict有序字典" class="headerlink" title="OrderedDict有序字典"></a>OrderedDict有序字典</h3><p>OrderedDict，<strong>作为有序字典使用</strong>, 在python2.x时期, 字典是无序的, 在python3.x后字典没有被定义成有序的, 但是对于同一个字典, 使用标识连接内部的数据, 因此读取时是按存储顺序取数据的</p>
<p>在序列化或编码后需保证字段的顺序的场合，它很有效。但是有序字典内部维护这一个<strong>根据键插入顺序排序的双向链表</strong>，对于已经存在键的重复赋值不会改变键的顺序。这种数据结构的<strong>大小是普通字典的两倍</strong>，如果要构建大量数据的数据结构，它可能不合适。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = OrderedDict()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = OrderedDict([(<span class="string">'name'</span>,<span class="string">'lisa'</span>),(<span class="string">'age'</span>,<span class="number">11</span>),(<span class="string">'gender'</span>,<span class="string">'female'</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">OrderedDict([(<span class="string">'name'</span>, <span class="string">'lisa'</span>), (<span class="string">'age'</span>, <span class="number">11</span>), (<span class="string">'gender'</span>, <span class="string">'female'</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">'face'</span>]=<span class="string">'nice'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">OrderedDict([(<span class="string">'name'</span>, <span class="string">'lisa'</span>), (<span class="string">'age'</span>, <span class="number">11</span>), (<span class="string">'gender'</span>, <span class="string">'female'</span>), (<span class="string">'face'</span>, <span class="string">'nice'</span>)])</span><br></pre></td></tr></table></figure>
<h3 id="defaultdict默认字典"><a href="#defaultdict默认字典" class="headerlink" title="defaultdict默认字典"></a>defaultdict默认字典</h3><p>defaultdict, <strong>作为默认字典使用</strong>，它能够在定义时给给定一个初始的类型， 这样就能够在输出定义没有的键值对时，初始化一个值。</p>
<p>使用方法:</p>
<p> <strong>a = defaultdict(factory_function)</strong>， 其中参数是工厂函数,它通常用于int,str,list,tuple,dict等，更多<a href="https://blog.csdn.net/qq_35891072/article/details/53428368" target="_blank" rel="noopener">工厂函数</a>点击</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = defaultdict(int)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="string">'age'</span>]</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">defaultdict(&lt;class 'int'&gt;, &#123;'age': 0&#125;)</span><br></pre></td></tr></table></figure>
<p>它的另一个使用场合就是<strong>为字典的键映射多个值</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#普通实现也很容易</span></span><br><span class="line">pairs = [(<span class="string">'a'</span>,<span class="number">1</span>), (<span class="string">'a'</span>,<span class="number">2</span>), (<span class="string">'b'</span>,<span class="number">1</span>), (<span class="string">'c'</span>,<span class="number">2</span>), (<span class="string">'b'</span>,<span class="number">2</span>)]</span><br><span class="line">print(pairs)</span><br><span class="line">d = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> pairs:</span><br><span class="line">	<span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> d:</span><br><span class="line">		d[key] = []</span><br><span class="line">	d[key].append(value)</span><br><span class="line">print(d) <span class="comment"># &#123;'a': [1, 2], 'b': [1, 2], 'c': [2]&#125;</span></span><br><span class="line"><span class="comment"># defaultdict实现</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">e = defaultdict(list)</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> pairs:</span><br><span class="line">	e[key].append(value)</span><br><span class="line">print(e) <span class="comment"># defaultdict(&lt;class 'list'&gt;, &#123;'a': [1, 2], 'b': [1, 2], 'c': [2]&#125;)</span></span><br></pre></td></tr></table></figure>
<h3 id="namedtuple命名元组"><a href="#namedtuple命名元组" class="headerlink" title="namedtuple命名元组"></a>namedtuple命名元组</h3><p>namedtuple函数通过一个普通的元组对象映射名称到元组中的每个元素。它返回一个Python标准元组类型子类的<a href="">工厂方法</a>。需要传入类型名和需要的字段(由[]括起来)，它返回一个能够初始化的类，并为定义的字段传递值。</p>
<p><code>namedtuple</code>与普通元组是可交换的， 它支持所有的普通元组操作， 例如切片、解压。</p>
<p>命名元组主要用途之一就是将你<strong>从下标操作解脱出来</strong>，你可以像使用对象的属性一样使用命名元组，但是你仍然也能使用下标。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Subscriber = namedtuple(<span class="string">'Student'</span>, [<span class="string">'name'</span>, <span class="string">'age'</span>])</span><br><span class="line">sub = Subscriber(<span class="string">'joy'</span>, <span class="number">15</span>)</span><br><span class="line">print(sub) <span class="comment"># Student(name='joy', age=15)</span></span><br><span class="line">print(sub.name, sub[<span class="number">0</span>]) <span class="comment"># joy joy</span></span><br><span class="line">print(sub.age, sub[<span class="number">1</span>]) <span class="comment"># 15 15</span></span><br></pre></td></tr></table></figure>
<p>命名元组另一个主要用途就是<strong>作为字典的替代</strong>，因为字典存储需要更多的存储空间。但是注意， <strong>不同于字典，一个命名元组时不可更改的。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">print(type(sub))</span><br><span class="line">sub.age = <span class="number">20</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">&lt;class '__main__.Student'&gt;</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File "D:\pycharm\pythoncode\practice\whiteboard\python_cookbook.py", line 224, in &lt;module&gt;</span></span><br><span class="line"><span class="string">    sub.age = 20</span></span><br><span class="line"><span class="string">AttributeError: can't set attribute</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>如果你非要改变命名元组， 你可以使用<code>_replace()</code>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sub = sub._replace(age=<span class="number">21</span>, name=<span class="string">'new_name'</span>)</span><br><span class="line">print(sub) <span class="comment"># Student(name='new_name', age=21)</span></span><br></pre></td></tr></table></figure>
<h3 id="ChainMap-合并字典"><a href="#ChainMap-合并字典" class="headerlink" title="ChainMap 合并字典"></a>ChainMap 合并字典</h3><p>用法: <strong>ChainMap(dict, dict, …)</strong>   chain意思是连锁，map意思是映射(在python中映射对应就是由键值对组成的字典类型)，<code>ChainMap</code>就是将两个或多个字典(并没有真正的合并)从逻辑组成一个新字典。</p>
<p>这个字典能够使用字典的大部分方法。</p>
<p><strong>也有一些需注意的地方</strong>: <u>如果出现重复键，总是会返回第一次出现键位置的值；对这个新字典使用更新或删除操作，它总是影响列表中的第一个字典。</u></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fromcollections <span class="keyword">import</span> ChainMap</span><br><span class="line"></span><br><span class="line">a = &#123;<span class="string">'name'</span>: <span class="string">'joy'</span>, <span class="string">'age'</span>: <span class="number">21</span>&#125;</span><br><span class="line">b = &#123;<span class="string">'height'</span>: <span class="number">180</span>, <span class="string">'hobby'</span>: [<span class="string">'sing'</span>, <span class="string">'play games'</span>]&#125;</span><br><span class="line">d = &#123;<span class="string">'class'</span>: <span class="string">'Student'</span>, <span class="string">'location'</span>: <span class="string">'Sichuan'</span>&#125;</span><br><span class="line">c = ChainMap(a, b, d)</span><br><span class="line">print(c) <span class="comment"># ChainMap(&#123;'name': 'joy', 'age': 21&#125;, &#123;'height': 180, 'hobby': ['sing', 'play games']&#125;, &#123;'class': 'Student', 'location': 'Sichuan'&#125;) </span></span><br><span class="line">print(c[<span class="string">'name'</span>]) <span class="comment"># joy</span></span><br><span class="line">print(c[<span class="string">'hobby'</span>]) <span class="comment"># ['sing', 'play games']</span></span><br><span class="line">print(c[<span class="string">'location'</span>]) <span class="comment"># Sichuan</span></span><br></pre></td></tr></table></figure>
<p>另外一种字典的合并方式就是使用<strong>update()</strong>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e = dict(b)</span><br><span class="line">e.update(a)</span><br><span class="line">print(e) <span class="comment"># &#123;'name': 'joy', 'height': 180, 'hobby': ['sing', 'play games'], 'age': 21&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="heapq模块"><a href="#heapq模块" class="headerlink" title="heapq模块"></a>heapq模块</h2><h3 id="heapq堆队列"><a href="#heapq堆队列" class="headerlink" title="heapq堆队列"></a>heapq堆队列</h3><p><code>heapq</code>模块通过<code>nsmallest</code>和<code>nlargest</code>可以实现查找一个集合中最小或最大的N(小于集合元素数量)个元素，它的底层实现是将集合数据进行堆排序后放入到一个列表中(<code>heapify方法</code>)。</p>
<p>所谓堆排序，就是….。<strong>堆数据结构最重要的特征就是heap[0]永远是最小的元素</strong>，并且通过<code>heappop()</code>可以获取下一个最小的元素，时间复杂度是O(log2N)；<code>heappush()</code>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> heapq</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nums = [<span class="number">1</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">-4</span>, <span class="number">18</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="number">37</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>part = heapq.nlargest(<span class="number">3</span>, nums)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(part)</span><br><span class="line">[<span class="number">42</span>, <span class="number">37</span>, <span class="number">23</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>heapq.heapify(nums)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(nums)</span><br><span class="line">[<span class="number">-4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="number">37</span>, <span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>heapq.heappop(nums)</span><br><span class="line"><span class="number">-4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>heapq.heappop(nums)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(nums)</span><br><span class="line">[<span class="number">2</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">37</span>, <span class="number">18</span>, <span class="number">23</span>, <span class="number">42</span>]</span><br></pre></td></tr></table></figure>
<p>同时<code>nlargest</code>和<code>nsmallest</code>两个方法，都有key参数，可以自定义比较方式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">portfolio = [</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'IBM'</span>, <span class="string">'shares'</span>: <span class="number">100</span>, <span class="string">'price'</span>: <span class="number">91.1</span>&#125;,</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'AAPL'</span>, <span class="string">'shares'</span>: <span class="number">50</span>, <span class="string">'price'</span>: <span class="number">543.22</span>&#125;,</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'FB'</span>, <span class="string">'shares'</span>: <span class="number">200</span>, <span class="string">'price'</span>: <span class="number">21.09</span>&#125;,</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'HPQ'</span>, <span class="string">'shares'</span>: <span class="number">35</span>, <span class="string">'price'</span>: <span class="number">31.75</span>&#125;,</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'YHOO'</span>, <span class="string">'shares'</span>: <span class="number">45</span>, <span class="string">'price'</span>: <span class="number">16.35</span>&#125;,</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'ACME'</span>, <span class="string">'shares'</span>: <span class="number">75</span>, <span class="string">'price'</span>: <span class="number">115.65</span>&#125;</span><br><span class="line">]</span><br><span class="line">cheap = heapq.nlargest(<span class="number">3</span>, portfolio, key=<span class="keyword">lambda</span> x: x[<span class="string">'shares'</span>])</span><br><span class="line">print(cheap) <span class="comment"># [&#123;'name': 'FB', 'shares': 200, 'price': 21.09&#125;, &#123;'name': 'IBM', 'shares': 100, 'price': 91.1&#125;, &#123;'name': 'ACME', 'shares': 75, 'price': 115.65&#125;]</span></span><br></pre></td></tr></table></figure>
<p>min和max</p>
<p>sorted(seq)[:N]通过排序切片操作</p>
<h2 id="operator模块"><a href="#operator模块" class="headerlink" title="operator模块"></a>operator模块</h2><p>基本上每个运算都可以使用其对应的魔术方法</p>
<h3 id="比较运算"><a href="#比较运算" class="headerlink" title="比较运算"></a>比较运算</h3><p>cmp用于python2.x中比较两个元素大小的函数, 在python3中已经被去掉了, 可以使用operator模块中的函数进行比较</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">operator.lt(a, b) operator.__lt__(a, b) </span><br><span class="line">operator.le(a, b) operator.__le__(a, b)</span><br><span class="line">operator.eq(a, b) operator.__eq__(a, b)</span><br><span class="line">operator.ne(a, b) operator.__ne__(a, b)</span><br><span class="line">operator.ge(a, b) operator.__ge__(a, b)</span><br><span class="line">operator.gt(a, b) operator.__gt__(a, b)</span><br></pre></td></tr></table></figure>
<h3 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">abs(obj)</span><br><span class="line">add(a, b) 加  iadd(a,b) +=</span><br><span class="line">sub(a, b) 减 isub(a,b) -=</span><br><span class="line">mul(a,b) __mul__(a,b) 乘积 imul(a,b) *=</span><br><span class="line">truediv(a,b) __truediv__(a,b) 除 itruediv(a,b) /=</span><br><span class="line">floordiv(a, b)  整除 ifloordiv(a,b) //=</span><br><span class="line">mod(a, b) __mod__(a,b) 求模</span><br><span class="line">matmul(a,b) __matmul_(a,b) 矩阵乘积</span><br><span class="line">pow(a,b) __pow__(a,b) a的b次方</span><br></pre></td></tr></table></figure>
<h3 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">and_(a, b) __and__(a, b) 与运算 iand(a,b) a &amp;= b </span><br><span class="line">or_(a, b) __or__(a, b) 或运算 ior(a,b) a |= b</span><br><span class="line">xor(a, b) __xor__(a,b) 异或运算(上下相同取<span class="number">0</span>，相异取<span class="number">1</span>) ixor(a.b) a ^= b</span><br><span class="line">inv(obj) invert(obj) __inv__(obj) __invert__(obj) 按位取反(一个有符号的二进制数的补码)</span><br><span class="line">lshift(a, b) __lshift__(a, b) a数左移b位 ilshift(a,b) a &lt;&lt;= b</span><br><span class="line">rshift(a, b) __rshift__(a, b) a数右移b位</span><br></pre></td></tr></table></figure>
<p><strong>移位运算符 </strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">8</span> &gt;&gt; <span class="number">1</span> </span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">8</span> &lt;&lt; <span class="number">1</span> <span class="comment"># 左移相当于 8 * (2 ** 1)</span></span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="number">8</span> &gt;&gt; <span class="number">3</span> <span class="comment"># 右移相当于 8 // 2**3</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>异或运算应用</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对于一个有奇数个N个整数组成的数组， 其中只有一个整数的数量为1个，其余全为2个或偶数个，找出这个整数</span></span><br><span class="line"><span class="comment"># 用普通循环的方式肯定不可行，需要利用异或运算的性质</span></span><br><span class="line"><span class="comment"># n ^ 0 = n  n ^ n = 0</span></span><br><span class="line">items = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">result = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">    result ^= item</span><br><span class="line">print(result) <span class="comment"># 5</span></span><br></pre></td></tr></table></figure>
<h3 id="序列运算"><a href="#序列运算" class="headerlink" title="序列运算"></a>序列运算</h3><h4 id="itemgetter基本数据排序"><a href="#itemgetter基本数据排序" class="headerlink" title="itemgetter基本数据排序"></a>itemgetter基本数据排序</h4><p><code>itemgetter</code>是一个函数，它作用于一个对象来获取指定位置的值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">func = itemgetter(<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">print(func(a)) <span class="comment"># (1, 2, 4)</span></span><br></pre></td></tr></table></figure>
<p>处理<strong>列表、元祖数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fruits = [(<span class="string">'orange'</span>,<span class="number">20</span>),(<span class="string">'apple'</span>, <span class="number">10</span>), (<span class="string">'banana'</span>, <span class="number">15</span>), (<span class="string">'banana'</span>, <span class="number">10</span>)]</span><br><span class="line">fruit2 = sorted(fruits, key=itemgetter(<span class="number">0</span>))</span><br><span class="line">fruit3 = sorted(fruits, key=itemgetter(<span class="number">1</span>))</span><br><span class="line">fruit4 = sorted(fruits, key=itemgetter(<span class="number">0</span>,<span class="number">1</span>)) <span class="comment"># 作用多个属性排序</span></span><br><span class="line">print(fruit2) <span class="comment"># [('apple', 10), ('banana', 15), ('banana', 10), ('orange', 20)]</span></span><br><span class="line">print(fruit3) <span class="comment"># [('apple', 10), ('banana', 10), ('banana', 15), ('orange', 20)]</span></span><br><span class="line">print(fruit3) <span class="comment"># [('apple', 10), ('banana', 10), ('banana', 15), ('orange', 20)]</span></span><br></pre></td></tr></table></figure>
<p>处理<strong>字典列表数据排序</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter</span><br><span class="line">test4 = [</span><br><span class="line">	&#123;<span class="string">'name'</span>: <span class="string">'joy'</span>, <span class="string">'age'</span>: <span class="number">20</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;,</span><br><span class="line">	&#123;<span class="string">'name'</span>: <span class="string">'haro'</span>, <span class="string">'age'</span>: <span class="number">20</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;,</span><br><span class="line">	&#123;<span class="string">'name'</span>: <span class="string">'zqi'</span>, <span class="string">'age'</span>: <span class="number">24</span>, <span class="string">'gender'</span>: <span class="string">'female'</span>&#125;,</span><br><span class="line">	&#123;<span class="string">'name'</span>: <span class="string">'rocket'</span>, <span class="string">'age'</span>: <span class="number">21</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;,	</span><br><span class="line">]</span><br><span class="line"><span class="comment"># sorted方法不会改变被处理的序列</span></span><br><span class="line">stus = sorted(test4, key=itemgetter(<span class="string">'age'</span>, <span class="string">'name'</span>))</span><br><span class="line"><span class="comment"># sort方法会改变被处理的序列</span></span><br><span class="line">test4.sort(key=itemgetter(<span class="string">'age'</span>, <span class="string">'name'</span>))</span><br><span class="line">print(stus)</span><br><span class="line"><span class="comment"># [&#123;'name': 'haro', 'age': 20, 'gender': 'male'&#125;, &#123;'name': 'joy', 'age': 20, 'gender': 'male'&#125;, &#123;'name': 'rocket', 'age': 21, 'gender': 'male'&#125;, &#123;'name': 'zqi', 'age': 24, 'gender': 'female'&#125;]</span></span><br><span class="line">print(test4)</span><br><span class="line"><span class="comment"># [&#123;'name': 'haro', 'age': 20, 'gender': 'male'&#125;, &#123;'name': 'joy', 'age': 20, 'gender': 'male'&#125;, &#123;'name': 'rocket', 'age': 21, 'gender': 'male'&#125;, &#123;'name': 'zqi', 'age': 24, 'gender': 'female'&#125;]</span></span><br></pre></td></tr></table></figure>
<p>当然，我们使用匿名函数也能实现，但是itemgetter的性能要好些</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stus = sorted(test4, key=<span class="keyword">lambda</span> item: (item[<span class="string">'age'</span>], item[<span class="string">'name'</span>]))</span><br></pre></td></tr></table></figure>
<p>还有max和min函数也是支持key参数的， 因此他们也能使用上述的方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stus = max(test4, key=itergetter(<span class="string">'age'</span>, <span class="string">'name'</span>))</span><br><span class="line">stus = min(test4, key=<span class="keyword">lambda</span> item: (item[<span class="string">'age'</span>], item[<span class="string">'name'</span>]))</span><br></pre></td></tr></table></figure>
<h4 id="attrgetter类的对象排序"><a href="#attrgetter类的对象排序" class="headerlink" title="attrgetter类的对象排序"></a>attrgetter类的对象排序</h4><p>对类的实例化对象进行排序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> attrgetter</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, userid, name)</span>:</span></span><br><span class="line">		self.userid = userid</span><br><span class="line">		self.name = name</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">f'&lt;User <span class="subst">&#123;self.userid&#125;</span> <span class="subst">&#123;self.name&#125;</span>&gt;'</span></span><br><span class="line"></span><br><span class="line">users = [User(<span class="number">10</span>, <span class="string">'joy'</span>), User(<span class="number">5</span>, <span class="string">'google'</span>), User(<span class="number">12</span>, <span class="string">'april'</span>), User(<span class="number">5</span>, <span class="string">'apple'</span>)]</span><br><span class="line">user_sort = sorted(users, key=attrgetter(<span class="string">'userid'</span>, <span class="string">'name'</span>))</span><br><span class="line"><span class="comment"># [&lt;User 5 apple&gt;, &lt;User 5 google&gt;, &lt;User 10 joy&gt;, &lt;User 12 april&gt;]</span></span><br></pre></td></tr></table></figure>
<p>匿名函数也可以实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_sort = sorted(users, key=<span class="keyword">lambda</span> obj: (obj.userid, obj.name))</span><br></pre></td></tr></table></figure>
<p>除此, 不要忘记<code>min/max</code>两个函数也能使用上述的函数</p>
<h2 id="python内置函数"><a href="#python内置函数" class="headerlink" title="python内置函数"></a>python内置函数</h2><h3 id="hasattr"><a href="#hasattr" class="headerlink" title="hasattr"></a>hasattr</h3><p><strong>hasattr(object, name)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">	name=<span class="string">'lip'</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">'runing'</span></span><br></pre></td></tr></table></figure>
<p>判断一个对象里面是否有name属性或name方法, 返回bool</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a= test()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hasattr(a, <span class="string">'name'</span>)</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hasattr(a, <span class="string">'run'</span>)</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hasattr(a, <span class="string">'age'</span>)</span><br><span class="line"><span class="keyword">False</span></span><br></pre></td></tr></table></figure>
<h3 id="getattr"><a href="#getattr" class="headerlink" title="getattr"></a>getattr</h3><p><strong>getattr(object, name[, default])</strong></p>
<p>获取对象object的属性或者方法, 若存在, 就将值打印出来;若不存在, 就返回错误，也可以使用默认值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(a, <span class="string">'name'</span>)</span><br><span class="line"><span class="string">'lip'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(a, <span class="string">'run'</span>)</span><br><span class="line">&lt;bound method test.run of &lt;__main__.test object at <span class="number">0x7f5861d50828</span>&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(a, <span class="string">'run'</span>)()</span><br><span class="line"><span class="string">'running'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(a, <span class="string">'age'</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">'test'</span> object has no attribute <span class="string">'age'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(a, <span class="string">'age'</span>, <span class="number">10</span>)</span><br><span class="line"><span class="number">10</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h3 id="setattr"><a href="#setattr" class="headerlink" title="setattr"></a>setattr</h3><p>setattr(object, name[, default])**</p>
<p>给对象的属性赋值(若属性不存在, 它会先创建再赋值)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>hasattr(a, <span class="string">'hobby'</span>)</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>setattr(a, <span class="string">'hobby'</span>, <span class="string">'sing song'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.hobby</span><br><span class="line"><span class="string">'sing song'</span></span><br></pre></td></tr></table></figure>
<p>综合使用:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(a, <span class="string">'status'</span>, setattr(a, <span class="string">'status'</span>, <span class="string">'well'</span>))</span><br><span class="line"><span class="string">'well'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.status</span><br><span class="line"><span class="string">'well'</span></span><br></pre></td></tr></table></figure>
<h3 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h3><p>zip函数用于将两个或多个可迭代对象进行整合(成元组形式的数据结构)，也可以用于二维数组到一维数组的转换。它的是实现是将同索引位置的元素进行最短序列长度的组合。更合适的使用方式是<strong>将两个等长序列组成字典的场景</strong>。</p>
<p><strong>注意:zip()函数返回的是一个迭代器(迭代器都只能使用一次)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = [<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>zip1 = zip(a,b,c)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> zip1:</span><br><span class="line"><span class="meta">... </span>    print(i)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">(<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>)</span><br><span class="line">(<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(zip1)</span><br><span class="line">[(<span class="number">1</span>,<span class="number">4</span>,<span class="number">7</span>),(<span class="number">2</span>,<span class="number">5</span>,<span class="number">8</span>),(<span class="number">3</span>,<span class="number">6</span>,<span class="number">8</span>)]</span><br><span class="line"><span class="comment"># 注: 当上面使用for...in就使用完迭代器zip1, 此时不能再使用list(zip1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将两个序列组成字典</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>keys = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>values = [<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>items = dict(zip(keys, values))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>items</span><br><span class="line">&#123;<span class="string">'a'</span>: <span class="string">'1'</span>, <span class="string">'b'</span>: <span class="string">'2'</span>, <span class="string">'c'</span>: <span class="string">'3'</span>&#125;</span><br><span class="line"><span class="comment"># 将两个序列组成列表</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>items2 = list(zip(keys, values))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>items2</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'1'</span>), (<span class="string">'b'</span>, <span class="string">'2'</span>), (<span class="string">'c'</span>, <span class="string">'3'</span>)]</span><br></pre></td></tr></table></figure>
<h3 id="all和any"><a href="#all和any" class="headerlink" title="all和any"></a>all和any</h3><p><code>all(iterable)/any(iterable)</code>，前者对一个序列中的所有数据进行检测是否为真，全为真就返回True；后者检查序列中是否存在真，存在就返回True</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># 取当前文件夹中所有文件</span></span><br><span class="line">files = os.listdir(os.path.dirname(__file__))</span><br><span class="line">print(files)</span><br><span class="line"><span class="keyword">if</span> all(name.endswith(<span class="string">'.py'</span>) <span class="keyword">for</span> name <span class="keyword">in</span> files):</span><br><span class="line">	print(<span class="string">'all file is python'</span>)</span><br><span class="line"><span class="keyword">elif</span> any(name.endswith(<span class="string">'.py'</span>) <span class="keyword">for</span> name <span class="keyword">in</span> files):</span><br><span class="line">	print(<span class="string">'exist file is python'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">'no python'</span>)</span><br></pre></td></tr></table></figure>
<p>上面隐藏一个知识点就是生成器表达式作为独立参数时，可以省略括号。而这个生成器也可以使用列表表达式替换。但是当数据量较大的时候，列表表达式因为会单独生成一个列表结构，浪费内存空间；而使用生成器表达式就不会有这样的问题。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成器</span></span><br><span class="line">all(name.endswith(<span class="string">'.py'</span>) <span class="keyword">for</span> name <span class="keyword">in</span> files)</span><br><span class="line">all((name.endswith(<span class="string">'.py'</span>) <span class="keyword">for</span> name <span class="keyword">in</span> files))</span><br><span class="line"><span class="comment"># 列表表达式</span></span><br><span class="line">all([name.endswith(<span class="string">'.py'</span>) <span class="keyword">for</span> name <span class="keyword">in</span> files])</span><br></pre></td></tr></table></figure>
<h3 id="globals和locals"><a href="#globals和locals" class="headerlink" title="globals和locals"></a>globals和locals</h3><h3 id="eval-exec-compile"><a href="#eval-exec-compile" class="headerlink" title="eval / exec / compile"></a>eval / exec / compile</h3><h2 id="并发编程"><a href="#并发编程" class="headerlink" title="并发编程"></a>并发编程</h2><h3 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h3><h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><h3 id="异步IO"><a href="#异步IO" class="headerlink" title="异步IO"></a>异步IO</h3><p>aiohttp asyncio await async</p>
<h4 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h4><p>yield </p>
<p>yield from</p>
<h2 id="哈希对象和可变类型"><a href="#哈希对象和可变类型" class="headerlink" title="哈希对象和可变类型"></a>哈希对象和可变类型</h2><h3 id="unhashable和hashable"><a href="#unhashable和hashable" class="headerlink" title="unhashable和hashable"></a>unhashable和hashable</h3><p>hashable即可哈希，unhashable即不可哈希</p>
<p><strong><code>一个对象能被称为 hashable ， 它必须有个 hash 值，这个值在整个生命周期都不会变化，而且必须可以进行相等比较，所以一个对象可哈希，它必须实现__hash__() 与 __eq__() 方法.</code> </strong></p>
<p>python的某些链接库在内部需要使用hash值，例如<strong>集合中添加对象需要使用<code>__hash__()</code>的方法获取哈希值，并比较它是否与集合中已有对象的hash值相同，若相同就比较<code>__eq__()</code>方法比较是否相等，以确定能否加入集合中</strong></p>
<p>另外一种<strong>集合中添加数据必须是可哈希的对象，字典中添加键值对中的键也必须是可哈希的对象</strong>。</p>
<p>对于python的内建类型来说，建立之后的数据无法修改的类型immutable才能是<code>hashable</code>,如字符串，元组，数值型int、float和bytes，除此对于自定义的方法(函数)或者类也是可哈希的；可修改的数据mutable才能是不可哈希的<code>unhashable</code>: 列表、字典、集合，<strong>它们在改变值的时候没有改变id，无法由地址定位值的唯一性，因此是不可哈希的</strong>。</p>
<p>总结:</p>
<ol>
<li>可修改的数据就是不可哈希的，不可修改的数据就是可哈希的(因为它们总能有由<strong>id定位</strong>值的唯一性)</li>
<li>集合中的元素必须是可哈希的， 但是集合本身却不可哈希</li>
<li>字典的键也必须是可哈希的</li>
</ol>
<h3 id="immutable和mutable"><a href="#immutable和mutable" class="headerlink" title="immutable和mutable"></a>immutable和mutable</h3><p>immutable即不可变， mutable即可变</p>
<p>python里面， 传递的都是对象的引用，也可以理解成地址。</p>
<p>可变类型就是对数据的修改是在原内存单元中进行。对于不可变类型，是不能修改值的，例如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">print(id(a))</span><br><span class="line">a = <span class="number">2</span></span><br><span class="line">print(id(a))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出:</span></span><br><span class="line"><span class="number">2012992560</span></span><br><span class="line"><span class="number">2012992576</span></span><br></pre></td></tr></table></figure>
<p>当使用a=2时， 原数据1的引用就已经被销毁了，此时是将2的引用给了a</p>
<p><strong>可变类型有:  list,  dict,  set</strong></p>
<p><strong>不可变类型有: int,  float,  complex,  str,   tuple</strong></p>
<h2 id="python规范"><a href="#python规范" class="headerlink" title="python规范"></a>python规范</h2><ul>
<li>lambda使用与单行函数, 如果代码超过60-80个字符，还是定于常规函数；对于常见的操作符， 如乘法，应该使用<code>operator.mul</code>而不是<code>lambda x, y: x * y</code></li>
<li>对于单行条件语句， 建议使用条件表达式，如<code>x = 1 if item else -1</code></li>
<li>鼓励使用默认参数值， 但是不要在默认参数是可变对象时使用</li>
<li>鼓励使用<code>if not user 或者 if user</code>， 但是对于None和False的区分时, 可以使用<code>if a is None 或者 if a is not None</code>, 对于整数如<strong>0和False</strong>的区分，使用<code>if a == 0 而不是if not a, 因为a可能取到空串, 空列表等出现误判</code></li>
</ul>

      
    </div>

    

    
    
    
	
	<div>

<div>

    <div style="text-align:center;color: #ccc;font-size:14px;">-------------end-------------</div>

</div>


</div>

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Map-Reduce/" rel="tag"><i class="fa fa-tag"></i> Map/Reduce</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/12/28/numpy/" rel="next" title="numpy">
                <i class="fa fa-chevron-left"></i> numpy
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/02/postgresql/" rel="prev" title="postgresql">
                postgresql <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/you.jpeg"
                alt="rzlong" />
            
              <p class="site-author-name" itemprop="name">rzlong</p>
              <p class="site-description motion-element" itemprop="description">If should see you, after long year. How <br> should i greet, with silence and tears.</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">36</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">36</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/rzlong" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.baidu.com" target="_blank" title="coding"><i class="fa fa-fw fa-spinner"></i>coding</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.baidu.com" target="_blank" title="weibo"><i class="fa fa-fw fa-weibo"></i>weibo</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.jianshu.com/u/cae36121456c" target="_blank" title="简书"><i class="fa fa-fw fa-copy"></i>简书</a>
                  
                </span>
              
            </div>
          

          
          

          
          
      <br/>
      <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=29498708&auto=1&height=66"></iframe>
      <br/>
          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#魔法方法"><span class="nav-number">1.</span> <span class="nav-text">魔法方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#init-和-new"><span class="nav-number">1.1.</span> <span class="nav-text">__init__ 和 __new__</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iter-和-next"><span class="nav-number">1.2.</span> <span class="nav-text">__iter__和__next__</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#enter-和-exit"><span class="nav-number">1.3.</span> <span class="nav-text">__enter__和__exit__</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hash-和-eq"><span class="nav-number">1.4.</span> <span class="nav-text">__hash__和__eq__</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#call"><span class="nav-number">1.5.</span> <span class="nav-text">__call__</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运算"><span class="nav-number">1.6.</span> <span class="nav-text">运算</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单例"><span class="nav-number">2.</span> <span class="nav-text">单例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#装饰器实现"><span class="nav-number">2.1.</span> <span class="nav-text">装饰器实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#元类"><span class="nav-number">2.2.</span> <span class="nav-text">元类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#迭代器和生产器"><span class="nav-number">3.</span> <span class="nav-text">迭代器和生产器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#迭代器"><span class="nav-number">3.1.</span> <span class="nav-text">迭代器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成器"><span class="nav-number">3.2.</span> <span class="nav-text">生成器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成式"><span class="nav-number">3.3.</span> <span class="nav-text">生成式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中间件"><span class="nav-number">4.</span> <span class="nav-text">中间件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#上下文语法"><span class="nav-number">5.</span> <span class="nav-text">上下文语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#contextmanger上下文管理器"><span class="nav-number">5.1.</span> <span class="nav-text">contextmanger上下文管理器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#atomic事务上下文管理器"><span class="nav-number">5.2.</span> <span class="nav-text">atomic事务上下文管理器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#装饰器"><span class="nav-number">6.</span> <span class="nav-text">装饰器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#不带参装饰器"><span class="nav-number">6.1.</span> <span class="nav-text">不带参装饰器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#带参装饰器"><span class="nav-number">6.2.</span> <span class="nav-text">带参装饰器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python高阶函数"><span class="nav-number">7.</span> <span class="nav-text">python高阶函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#filter过滤"><span class="nav-number">7.1.</span> <span class="nav-text">filter过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#map映射"><span class="nav-number">7.2.</span> <span class="nav-text">map映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sorted排序"><span class="nav-number">7.3.</span> <span class="nav-text">sorted排序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#functools模块"><span class="nav-number">8.</span> <span class="nav-text">functools模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#reduce化简"><span class="nav-number">8.1.</span> <span class="nav-text">reduce化简</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wraps"><span class="nav-number">8.2.</span> <span class="nav-text">wraps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#partial"><span class="nav-number">8.3.</span> <span class="nav-text">partial</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lru-cache"><span class="nav-number">8.4.</span> <span class="nav-text">lru_cache</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#itertools模块"><span class="nav-number">9.</span> <span class="nav-text">itertools模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#groupby数据分组"><span class="nav-number">9.1.</span> <span class="nav-text">groupby数据分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#compress过滤"><span class="nav-number">9.2.</span> <span class="nav-text">compress过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#permutations排列"><span class="nav-number">9.3.</span> <span class="nav-text">permutations排列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#combinations组合"><span class="nav-number">9.4.</span> <span class="nav-text">combinations组合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#product笛卡尔积"><span class="nav-number">9.5.</span> <span class="nav-text">product笛卡尔积</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#collections模块"><span class="nav-number">10.</span> <span class="nav-text">collections模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#deque双端队列"><span class="nav-number">10.1.</span> <span class="nav-text">deque双端队列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Counter计数器"><span class="nav-number">10.2.</span> <span class="nav-text">Counter计数器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OrderedDict有序字典"><span class="nav-number">10.3.</span> <span class="nav-text">OrderedDict有序字典</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#defaultdict默认字典"><span class="nav-number">10.4.</span> <span class="nav-text">defaultdict默认字典</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#namedtuple命名元组"><span class="nav-number">10.5.</span> <span class="nav-text">namedtuple命名元组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ChainMap-合并字典"><span class="nav-number">10.6.</span> <span class="nav-text">ChainMap 合并字典</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#heapq模块"><span class="nav-number">11.</span> <span class="nav-text">heapq模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#heapq堆队列"><span class="nav-number">11.1.</span> <span class="nav-text">heapq堆队列</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#operator模块"><span class="nav-number">12.</span> <span class="nav-text">operator模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#比较运算"><span class="nav-number">12.1.</span> <span class="nav-text">比较运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数学运算"><span class="nav-number">12.2.</span> <span class="nav-text">数学运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#逻辑运算"><span class="nav-number">12.3.</span> <span class="nav-text">逻辑运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#序列运算"><span class="nav-number">12.4.</span> <span class="nav-text">序列运算</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#itemgetter基本数据排序"><span class="nav-number">12.4.1.</span> <span class="nav-text">itemgetter基本数据排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#attrgetter类的对象排序"><span class="nav-number">12.4.2.</span> <span class="nav-text">attrgetter类的对象排序</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python内置函数"><span class="nav-number">13.</span> <span class="nav-text">python内置函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#hasattr"><span class="nav-number">13.1.</span> <span class="nav-text">hasattr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#getattr"><span class="nav-number">13.2.</span> <span class="nav-text">getattr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setattr"><span class="nav-number">13.3.</span> <span class="nav-text">setattr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zip"><span class="nav-number">13.4.</span> <span class="nav-text">zip</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#all和any"><span class="nav-number">13.5.</span> <span class="nav-text">all和any</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#globals和locals"><span class="nav-number">13.6.</span> <span class="nav-text">globals和locals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#eval-exec-compile"><span class="nav-number">13.7.</span> <span class="nav-text">eval / exec / compile</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#并发编程"><span class="nav-number">14.</span> <span class="nav-text">并发编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#多进程"><span class="nav-number">14.1.</span> <span class="nav-text">多进程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多线程"><span class="nav-number">14.2.</span> <span class="nav-text">多线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异步IO"><span class="nav-number">14.3.</span> <span class="nav-text">异步IO</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#协程"><span class="nav-number">14.3.1.</span> <span class="nav-text">协程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#哈希对象和可变类型"><span class="nav-number">15.</span> <span class="nav-text">哈希对象和可变类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#unhashable和hashable"><span class="nav-number">15.1.</span> <span class="nav-text">unhashable和hashable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#immutable和mutable"><span class="nav-number">15.2.</span> <span class="nav-text">immutable和mutable</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python规范"><span class="nav-number">16.</span> <span class="nav-text">python规范</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rzlong</span>

  

  
</div>





  <div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Mist</a> v6.4.2</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共69.2k字</span>
</div>

        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


















  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  

  <!--<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>-->
  <script type="text/javascript" src="/js/src/love.js"></script>

</body>
</html>
